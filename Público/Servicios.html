<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../Css/servicios.css">
  <title>Servicios - Energym</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    .filters { max-width: 1200px; margin: 0 auto 16px; display: flex; gap: 12px; align-items: center; }
    .filters input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; }
    .reserve-btn { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; padding: 10px 14px; border-radius: 12px; text-decoration: none; font-weight: 700; }
    .price { font-weight: 800; color: #4f46e5; }
    .mensaje { max-width: 1200px; margin: 8px auto; padding: 12px 16px; border-radius: 10px; font-weight: 600; display:none; }
    .mensaje.error { background: #fde8e8; color: #b91c1c; }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <h1>Energym</h1>
      <ul>
        <li><a href="PaginaPrincipal.html">Inicio</a></li>
        <li><a href="PagAcercaDe.html">Acerca de</a></li>
        <li><a href="Contactenos.html">Contáctenos</a></li>
        <li><a href="Servicios.html" class="active">Servicio</a></li>
        <li><a href="Mapa.html">Mapa</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section class="hero-section">
      <div class="hero-content">
        <h2>Nuestros Servicios</h2>
        <p>Descubre todas las opciones que tenemos para ayudarte a alcanzar tus metas fitness</p>
      </div>
    </section>

    <div id="msg" class="mensaje error"></div>

    <section class="services-section">
      <div id="grid" class="services-grid"></div>
    </section>

    <section class="cta-section">
      <div class="cta-content">
        <h3>¿Listo para comenzar?</h3>
        <p>Únete a Energym y transforma tu vida fitness</p>
        <div class="cta-buttons">
          <a href="RegistroAtleta.html" class="btn-primary"><i class="fas fa-user-plus"></i> Registrarse</a>
          <a href="SeleccionTipoUsuario.html" class="btn-secondary"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4>Energym</h4>
        <p>Transformando vidas a través del fitness</p>
      </div>
      <div class="footer-section">
        <h4>Contacto</h4>
        <p><i class="fas fa-phone"></i> +506 8957 7890</p>
        <p><i class="fas fa-envelope"></i> info@energym.com</p>
      </div>
      <div class="footer-section">
        <h4>Síguenos</h4>
        <div class="social-links">
          <a href="https://www.facebook.com/energymcr/?locale=es_LA"><i class="fab fa-facebook"></i></a>
          <a href="https://www.instagram.com/energym_cr/?hl=es"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Energym. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script>
    let usuarioActual = null;
    fetch('../Php/obtener_datos_usuario.php')
      .then(r => r.ok ? r.json() : null)
      .then(u => { usuarioActual = u; })
      .catch(()=>{});

    let servicios = [];
    fetch('../Php/listar_servicios.php')
      .then(r => r.json())
      .then(data => { servicios = data || []; render(servicios); })
      .catch(() => {
        const m = document.getElementById('msg');
        m.textContent = 'No se pudieron cargar los servicios.';
        m.style.display = 'block';
      });

    document.getElementById('buscador').addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      const fil = servicios.filter(s =>
        (s.nombre || '').toLowerCase().includes(q) || (s.codigo || '').toLowerCase().includes(q)
      );
      render(fil);
    });

    function quitarAcentos(txt){
      return (txt || '').normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }

    function getImagenServicio(s){
      const nombre = quitarAcentos((s.nombre || '').toLowerCase());
      const codigo = (s.codigo || '').toLowerCase();
      const palabras = [nombre, codigo].join(' ');

      const mapa = [
        { k: ['cardio'], img: 'cardio.jpg' },
        { k: ['funcional','funcionales'], img: 'Funcionales.jpg' },
        { k: ['pesas','mancuernas','fuerza'], img: 'Mancuernas.jpg' },
        { k: ['nutricion','nutricion deportiva','nutricion_deportiva'], img: 'Nutrición_Deportiva.jpg' },
        { k: ['sauna','recuperacion','recuperación'], img: 'Sauna_Recuperacion.jpg' },
        { k: ['piscina','acuatico','acuatico'], img: 'Piscina.jpg' }
      ];

      for (const m of mapa){
        if (m.k.some(x => palabras.includes(x))) return m.img;
      }
      return 'images.jpg';
    }

    function render(items) {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      if (!items || items.length === 0) {
        grid.innerHTML = '<p>No hay servicios disponibles.</p>';
        return;
      }
      items.forEach(s => {
        const card = document.createElement('div');
        card.className = 'service-card';
        card.innerHTML = `
          <div class="service-image"><img src="../Imagenes/${getImagenServicio(s)}" alt="${s.nombre || 'Servicio'}"></div>
          <div class="service-content">
            <div class="service-icon"><i class="fas fa-dumbbell"></i></div>
            <h3>${s.nombre || 'Servicio'}</h3>
            <p>Código: ${s.codigo || '-'}</p>
            ${s.costo ? `<p class="price">Costo: ₡${s.costo}</p>` : ''}
            <div style="margin-top:10px;">
              ${usuarioActual ? `<a class="reserve-btn" href="nueva_reservacion.html?servicio=${encodeURIComponent(s.codigo)}"><i class='fas fa-calendar-plus'></i> Reservar</a>` : ''}
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }
  </script>
</body>
</html>